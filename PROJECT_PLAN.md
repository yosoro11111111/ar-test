# AR角色项目完善方案

## 1. 开屏加载界面美化

### 设计思路
- **背景**: 使用动态渐变背景 + 粒子动画效果
- **Logo**: 添加品牌Logo动画（缩放 + 淡入）
- **加载进度**: 
  - 圆形进度条 + 百分比显示
  - 加载提示文字轮播（"正在初始化3D引擎..." "正在加载模型资源..."）
- **视觉效果**: 
  - 添加扫描线效果
  - 底部添加版本号
  - 加载完成后有"进入体验"按钮

### 技术实现
- 使用 CSS 动画 + Canvas 粒子系统
- 添加加载状态管理（0-100% 进度模拟）

---

## 2. 人物选择界面搜索功能

### 功能需求
- **搜索框**: 顶部添加搜索栏，支持实时搜索
- **搜索维度**: 
  - 按名字搜索（模糊匹配）
  - 按标签搜索（可爱/帅气/战斗/日常）
  - 按来源搜索（原神/崩坏/自定义）
- **搜索结果**: 高亮显示匹配文字
- **空状态**: 无结果时显示提示 + 推荐人物

### 数据结构
```javascript
{
  name: "角色名",
  filename: "xxx.vrm",
  tags: ["可爱", "女性"],
  source: "原神",
  thumbnail: "/thumbnails/xxx.jpg"
}
```

---

## 3. 文件上传界面优化

### 界面改进
- **拖拽区域**: 
  - 增大拖拽区域
  - 拖拽时有视觉反馈（边框高亮 + 放大效果）
  - 添加虚线边框 + 上传图标
- **格式提示**: 
  - 明确显示 "仅支持 .vrm 格式"
  - 添加文件大小限制提示（最大 100MB）
- **文件预览**: 
  - 上传后显示文件名 + 大小
  - 添加删除按钮

### 交互优化
- 支持多文件选择
- 拖拽时显示"释放以上传"

---

## 4. 首个人物加载进度条

### 显示位置
- 在左侧人物选择按钮上显示小型进度环
- 或在模型位置显示半透明加载遮罩

### 进度信息
- 显示 "加载中... 45%"
- 分阶段显示：
  1. 下载模型文件
  2. 解析VRM数据
  3. 初始化骨骼
  4. 加载完成

---

## 5. 初始人物高度调整

### 实现方案
- 修改默认 `characterScale` 从 1.5 改为 1.2（80%）
- 或在模型加载完成后，自动调整 `vrm.scene.scale.set(0.8, 0.8, 0.8)`
- 添加高度调节滑块（50% - 150%）

---

## 6. 人物管理系统重做

### 界面布局
```
┌─────────────────────────────────────┐
│  AR角色    [新建] [删除] [编辑] [排序] │  ← 顶部工具栏
├─────────────────────────────────────┤
│                                     │
│    ┌───┐   ┌───┐   ┌───┐   ┌───┐   │
│    │ 1 │   │ 2 │   │ 3 │   │ + │   │  ← 人物槽位（最多4个）
│    └───┘   └───┘   └───┘   └───┘   │
│    选中    空闲    空闲    添加     │
│                                     │
└─────────────────────────────────────┘
```

### 功能设计

#### 6.1 新建人物
- 点击 "+" 或 "新建" 按钮
- 弹出选择界面：
  - 从人物库选择
  - 上传本地VRM文件
  - 从最近使用选择

#### 6.2 删除人物
- 长按人物槽位显示删除选项
- 或选中后点击顶部"删除"按钮
- 确认弹窗防止误删

#### 6.3 选中/切换人物
- 点击槽位切换当前编辑的人物
- 选中状态有视觉反馈（边框高亮）
- 切换时保持相机位置

#### 6.4 编辑人物
- 重命名
- 调整默认姿势
- 设置默认动作

#### 6.5 排序
- 拖拽调整人物顺序
- 影响显示层级

### 数据结构
```javascript
{
  id: "uuid",
  name: "角色名",
  modelPath: "/models/xxx.vrm",
  thumbnail: "/thumbnails/xxx.jpg",
  defaultPose: "idle",
  scale: 1.0,
  position: [0, 0, 0],
  createdAt: "2024-01-01",
  isFavorite: false
}
```

---

## 7. 动作系统扩充（100种姿势）

### 分类设计

#### 7.1 基础动作 (20种)
- 待机、行走、奔跑、跳跃、坐下、躺下
- 站立、蹲下、爬行、攀爬、游泳、飞行
- 打招呼、挥手、鼓掌、鞠躬、敬礼、握手
- 思考、观察、等待

#### 7.2 情绪表情 (20种)
- 开心、大笑、微笑、害羞、调皮
- 伤心、哭泣、委屈、失望、沮丧
- 生气、愤怒、暴躁、傲娇、冷漠
- 惊讶、震惊、害怕、紧张、困惑

#### 7.3 战斗动作 (20种)
- 攻击、防御、闪避、格挡、受击
- 拔剑、收剑、瞄准、射击、装填
- 施法、吟唱、召唤、变身、爆发
- 胜利、失败、挑衅、嘲讽、警戒

#### 7.4 舞蹈动作 (20种)
- 街舞、芭蕾、拉丁、爵士、现代舞
- 宅舞、手势舞、机械舞、霹雳舞、钢管舞
- 双人舞、群舞、独舞、伴舞、领舞
- 旋转、跳跃、滑步、定格、收尾

#### 7.5 日常动作 (20种)
- 吃饭、喝水、睡觉、起床、洗漱
- 看书、写字、画画、弹琴、唱歌
- 打电话、玩手机、拍照、自拍、直播
- 购物、做饭、打扫、运动、休息

### 姿势系统（静态）
- **站立姿势**: 军姿、放松、叉腰、抱胸、背手
- **坐姿**: 正坐、侧坐、盘腿、跪坐、翘腿
- **手势**: 剪刀手、比心、OK、点赞、指方向
- **表情**: 眨眼、嘟嘴、吐舌、挑眉、闭眼

### 实现方案
- 使用 VRM 的 BlendShape 控制表情
- 使用骨骼旋转控制姿势
- 添加姿势预设保存功能

---

## 8. 骨骼编辑器改进

### 新界面设计
```
┌─────────────────────────────────────┐
│  🦴 骨骼编辑器                    [X] │
├─────────────────────────────────────┤
│  [头部] [颈部] [胸部] [脊柱] ...     │  ← 骨骼选择按钮
├─────────────────────────────────────┤
│  当前: 头部                          │
│                                     │
│  旋转 X: [━━━━━━━━●━━━━] 45°        │  ← 滑块控制
│  旋转 Y: [━━━━●━━━━━━━━] -30°       │
│  旋转 Z: [━━━━━━━━━━●━━] 60°        │
│                                     │
│  [复位] [镜像] [保存姿势]            │
└─────────────────────────────────────┘
```

### 功能改进
1. **滑块控制**: 替代按钮，更直观
2. **实时预览**: 拖动时实时更新模型
3. **数值显示**: 显示当前角度值
4. **复位功能**: 一键恢复默认角度
5. **镜像功能**: 左右对称调整
6. **保存姿势**: 保存当前骨骼状态为预设

### 交互优化
- 支持手势：双指缩放旋转速度
- 添加陀螺仪控制（手机倾斜控制旋转）

---

## 9. 视频录制保留模型界面

### 问题分析
- 当前录制可能只录制了摄像头画面
- 需要同时录制 3D 场景

### 解决方案
- 使用 `MediaRecorder` 录制 Canvas 输出
- 或使用 `html2canvas` + `ffmpeg.js` 合成
- 录制时显示录制指示器（红点闪烁）

### 实现步骤
1. 创建离屏 Canvas
2. 将视频帧和 3D 场景合成
3. 使用 MediaRecorder 录制
4. 导出视频文件

---

## 10. 更新/重置按钮

### 功能设计
- **位置**: 设置面板或顶部工具栏
- **图标**: 🔄 或 "更新"
- **功能**:
  1. 清除所有缓存数据
  2. 重新加载所有模型
  3. 重置所有设置为默认
  4. 刷新页面（可选）

### 确认弹窗
```
┌─────────────────────────┐
│ ⚠️ 确认更新              │
│                         │
│ 这将清除所有未保存的     │
│ 数据并重新加载。         │
│                         │
│      [取消]  [确认]      │
└─────────────────────────┘
```

---

## 11. 所有界面添加关闭按钮

### 需要添加关闭按钮的界面
1. ✅ 人物选择界面
2. ✅ 设置面板
3. ✅ 骨骼编辑器
4. ✅ 调试面板
5. ✅ 动作选择面板
6. ✅ 道具选择面板
7. ✅ 帮助面板
8. ✅ 模型上传界面

### 关闭按钮样式
- 右上角 "X" 图标
- 点击背景遮罩关闭
- 支持 ESC 键关闭

---

## 12. 其他补充建议

### 12.1 数据持久化
- 使用 LocalStorage 保存：
  - 用户设置
  - 最近使用的人物
  - 自定义姿势
  - 收藏列表

### 12.2 性能优化
- 模型 LOD（细节层次）
- 骨骼动画优化
- 纹理压缩
- 懒加载

### 12.3 社交功能
- 截图分享
- 姿势码分享（导出/导入姿势配置）
- 人物分享

### 12.4 多语言支持
- 中文、英文、日文
- 根据系统语言自动切换

### 12.5 辅助功能
- 色盲模式
- 高对比度模式
- 字体大小调节

### 12.6 统计功能
- 使用时长统计
- 拍照数量统计
- 常用动作统计

### 12.7 快捷键
- 空格：播放/暂停动作
- 方向键：微调位置
- 数字键：快速切换人物
- Ctrl+S：保存截图

### 12.8 背景系统
- 纯色背景
- 渐变背景
- 图片背景
- 动态背景
- 透明背景（AR模式）

### 12.9 光照系统
- 预设光照方案（日间/夜间/舞台）
- 自定义光源位置
- 阴影开关

### 12.10 导出功能
- 导出 PNG/JPG（带透明通道）
- 导出 GIF 动图
- 导出视频
- 导出姿势配置文件

---

## 实施优先级

### P0（核心功能）
1. 人物管理系统重做
2. 动作扩充到100种
3. 骨骼编辑器改进

### P1（体验优化）
4. 开屏加载界面美化
5. 人物选择搜索
6. 所有界面添加关闭按钮

### P2（增强功能）
7. 视频录制优化
8. 更新按钮
9. 文件上传优化

### P3（高级功能）
10. 数据持久化
11. 社交分享
12. 多语言支持

---

## 技术选型建议

### 动画库
- **Framer Motion**: React 动画
- **GSAP**: 复杂时间轴动画
- **Lottie**: JSON 动画

### 状态管理
- **Zustand**: 轻量级状态管理
- 或继续使用 React Context

### 存储
- **LocalStorage**: 用户设置
- **IndexedDB**: 大型数据（模型缓存）

### 构建优化
- **Vite PWA**: 离线支持
- **Service Worker**: 资源缓存

---

## 注意事项

1. **移动端适配**: 所有功能需考虑触摸操作
2. **性能监控**: 添加 FPS 监控，低于 30fps 时自动降级
3. **错误处理**: 每个功能都要有错误边界
4. **加载策略**: 大功能模块懒加载
5. **兼容性**: 测试主流浏览器和机型
